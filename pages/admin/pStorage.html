<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin ¬∑ Product Storage</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            kkpink: '#ff69b4',
          }
        }
      }
    }
  </script>

  <!-- KK base + components -->
  <link rel="stylesheet" href="/css/theme/base.css">
  <link rel="stylesheet" href="/css/theme/components.css">

  <style>
    /* Custom scrollbar for tables */
    .custom-scrollbar::-webkit-scrollbar { height: 8px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: #000; }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #333; }

    /* Row hover effect */
    .storage-row:hover { background: #fafafa; }
    .storage-row:hover .row-actions { opacity: 1; }
    .row-actions { opacity: 0.5; transition: opacity 0.15s; }

    /* Stage badges */
    .stage-idea { background: #f3f4f6; color: #374151; }
    .stage-researching { background: #dbeafe; color: #1e40af; }
    .stage-sample { background: #fef3c7; color: #92400e; }
    .stage-pricing { background: #ede9fe; color: #5b21b6; }
    .stage-ready { background: #d1fae5; color: #065f46; }
    .stage-archived { background: #1f2937; color: #fff; }

    /* Mobile improvements */
    @media (max-width: 640px) {
      button, [role="button"] { min-height: 44px; }
      input, select, textarea { font-size: 16px !important; }
    }
  </style>
</head>

<body class="kk-page kk-admin bg-gray-50 min-h-screen">
  <!-- Admin Nav mount -->
  <div id="kkAdminNavMount"></div>

  <main class="max-w-7xl mx-auto px-2 sm:px-6 py-4 sm:py-8">

    <!-- Header Card -->
    <header class="bg-white rounded-2xl shadow-sm border border-gray-200 p-4 sm:p-6 mb-4 sm:mb-6">
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <div>
          <div class="inline-block bg-black text-white px-2 py-1 text-[10px] font-black uppercase tracking-[.25em] mb-2">
            Admin Panel
          </div>
          <h1 class="text-2xl sm:text-4xl font-black tracking-tight flex items-center gap-2">
            <span>üì¶</span> Product Storage
          </h1>
          <p class="text-xs sm:text-sm text-gray-500 mt-1">
            Wishlist & pipeline products ‚Äî ideas, samples, and pricing research
          </p>
        </div>

        <div id="ps_status" class="flex items-center gap-2 text-sm bg-gray-100 rounded-lg px-3 py-2">
          <div class="w-2 h-2 rounded-full bg-gray-400 animate-pulse"></div>
          <span class="text-gray-600">Loading‚Ä¶</span>
        </div>
      </div>
    </header>

    <!-- Controls -->
    <section class="bg-white rounded-2xl shadow-sm border border-gray-200 p-3 sm:p-4 mb-4 sm:mb-6">
      <div class="flex flex-col sm:flex-row gap-3 sm:gap-4 items-stretch sm:items-end">
        <!-- Search -->
        <div class="flex-1">
          <label for="searchInput"
                 class="block text-[9px] sm:text-[10px] font-black uppercase tracking-[.18em] mb-1 sm:mb-2 text-gray-500">
            Search
          </label>
          <div class="relative">
            <input
              id="searchInput"
              type="search"
              placeholder="Search name, ID, or tags..."
              class="w-full border-4 border-black px-3 sm:px-4 py-2 sm:py-3 text-sm outline-none pr-10 focus:border-kkpink transition-colors"
            />
            <svg class="absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
          </div>
        </div>

        <!-- Stage Filter -->
        <div class="w-full sm:w-48">
          <label for="stageFilter"
                 class="block text-[9px] sm:text-[10px] font-black uppercase tracking-[.18em] mb-1 sm:mb-2 text-gray-500">
            Stage
          </label>
          <select id="stageFilter" class="w-full border-4 border-black px-3 py-2 sm:py-3 text-sm outline-none bg-white focus:border-kkpink transition-colors">
            <option value="">All Stages</option>
            <option value="idea">üí° Idea</option>
            <option value="researching">üîç Researching</option>
            <option value="sample">üì¶ Sample</option>
            <option value="pricing">üí∞ Pricing</option>
            <option value="ready">‚úÖ Ready</option>
            <option value="archived">üìÅ Archived</option>
          </select>
        </div>

        <!-- Add Button -->
        <button
          id="btnNew"
          type="button"
          class="flex items-center justify-center gap-2 border-4 border-black bg-black text-white px-5 py-2 sm:py-3 font-black uppercase tracking-[.12em] text-xs
                 hover:bg-kkpink hover:border-kkpink hover:text-black transition-all"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24">
            <path stroke-linecap="round" d="M12 4v16m8-8H4"></path>
          </svg>
          <span>Add Item</span>
        </button>
      </div>

      <div id="countLabel" class="mt-3 text-xs text-gray-500 font-medium">0 items</div>
    </section>

    <!-- Mobile Card View -->
    <section id="mobileCards" class="sm:hidden space-y-3">
      <!-- Cards injected by JS -->
    </section>

    <!-- Desktop Table View -->
    <section class="hidden sm:block bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden">
      <div class="overflow-x-auto custom-scrollbar">
        <table class="w-full text-left text-sm min-w-[800px]">
          <thead class="bg-black text-white">
            <tr class="uppercase tracking-[.12em] text-[11px] font-black">
              <th class="px-4 py-4">Item</th>
              <th class="px-4 py-4">Stage</th>
              <th class="px-4 py-4 text-right">Target</th>
              <th class="px-4 py-4 text-right">Cost</th>
              <th class="px-4 py-4 text-right">Margin</th>
              <th class="px-4 py-4 text-right">Actions</th>
            </tr>
          </thead>
          <tbody id="storageRows" class="divide-y divide-gray-200">
            <!-- Rows injected by JS -->
          </tbody>
        </table>
      </div>

      <!-- Empty State -->
      <div id="emptyState" class="hidden p-8 text-center">
        <div class="text-4xl mb-3">üì¶</div>
        <div class="text-gray-500 text-sm">No items in storage</div>
      </div>
    </section>

  </main>

  <!-- MODAL -->
  <div id="modal" class="hidden fixed inset-0 z-[200]" aria-hidden="true">
    <!-- Backdrop -->
    <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" data-kk-close></div>

    <!-- Stage -->
    <div class="relative h-full w-full overflow-y-auto">
      <div class="min-h-full flex items-end sm:items-center justify-center p-0 sm:p-6">
        <!-- Card -->
        <div class="w-full sm:max-w-2xl bg-white border-0 sm:border-4 border-black shadow-none sm:shadow-[8px_8px_0_0_rgba(0,0,0,0.1)] min-h-screen sm:min-h-0 flex flex-col max-h-screen sm:max-h-[90vh]">
          <!-- Head -->
          <div class="sticky top-0 z-10 flex items-center justify-between gap-3 p-3 sm:p-5 border-b-4 border-black bg-white shrink-0">
            <div class="min-w-0">
              <div class="inline-block bg-purple-500 text-white px-2 py-0.5 text-[8px] sm:text-[9px] font-black uppercase tracking-[.2em] mb-1">
                Product Storage
              </div>
              <h3 id="modalTitle" class="text-lg sm:text-2xl font-black tracking-tight">
                Edit Item
              </h3>
              <p class="text-xs text-gray-500 mt-0.5">Update product details</p>
            </div>

            <button
              id="btnClose"
              type="button"
              class="border-4 border-black bg-white w-10 h-10 flex items-center justify-center font-black text-lg
                     hover:bg-black hover:text-white transition-colors flex-shrink-0"
              aria-label="Close"
            >
              ‚úï
            </button>
          </div>

          <!-- Body (Scrollable) -->
          <div class="flex-1 overflow-y-auto p-3 sm:p-6 space-y-6">
            <input id="fId" type="hidden" />

            <!-- Message -->
            <div id="modalMsg" class="hidden p-3 border-4 border-red-300 bg-red-50 text-red-700 text-sm"></div>

            <!-- Basics Section -->
            <section>
              <div class="text-[11px] font-black uppercase tracking-[.25em] flex items-center gap-2 mb-4">
                <span class="w-5 h-5 bg-black text-white text-[10px] flex items-center justify-center">1</span>
                Basics
              </div>

              <div class="grid sm:grid-cols-2 gap-4">
                <div>
                  <label for="fName" class="block text-[11px] font-black uppercase tracking-[.12em] mb-1 text-black/70">
                    Item Name *
                  </label>
                  <input id="fName" placeholder="Satin-lined beanie blank" class="w-full border-[4px] border-black px-3 py-2 text-sm outline-none focus:border-kkpink transition-colors" />
                </div>

                <div>
                  <label for="fProductId" class="block text-[11px] font-black uppercase tracking-[.12em] mb-1 text-black/70">
                    Product ID
                  </label>
                  <input id="fProductId" placeholder="KK-1042" class="w-full border-[4px] border-black px-3 py-2 text-sm outline-none focus:border-kkpink transition-colors" />
                </div>

                <div class="sm:col-span-2">
                  <label for="fUrl" class="block text-[11px] font-black uppercase tracking-[.12em] mb-1 text-black/70">
                    Item Link
                  </label>
                  <input id="fUrl" placeholder="https://..." class="w-full border-[4px] border-black px-3 py-2 text-sm outline-none focus:border-kkpink transition-colors" />
                </div>

                <div>
                  <label for="fStage" class="block text-[11px] font-black uppercase tracking-[.12em] mb-1 text-black/70">
                    Stage
                  </label>
                  <select id="fStage" class="w-full border-[4px] border-black px-3 py-2 text-sm bg-white outline-none focus:border-kkpink transition-colors">
                    <option value="idea">üí° Idea</option>
                    <option value="researching">üîç Researching</option>
                    <option value="sample">üì¶ Sample</option>
                    <option value="pricing">üí∞ Pricing</option>
                    <option value="ready">‚úÖ Ready</option>
                    <option value="archived">üìÅ Archived</option>
                  </select>
                </div>

                <div>
                  <label for="fTags" class="block text-[11px] font-black uppercase tracking-[.12em] mb-1 text-black/70">
                    Tags (comma separated)
                  </label>
                  <input id="fTags" placeholder="supplierA, beanie, mto" class="w-full border-[4px] border-black px-3 py-2 text-sm outline-none focus:border-kkpink transition-colors" />
                </div>
              </div>
            </section>

            <div class="border-t-4 border-gray-100"></div>

            <!-- Costs Section -->
            <section>
              <div class="text-[11px] font-black uppercase tracking-[.25em] flex items-center gap-2 mb-4">
                <span class="w-5 h-5 bg-black text-white text-[10px] flex items-center justify-center">2</span>
                Costs & Pricing
              </div>
              <p class="text-xs text-gray-500 mb-4">Fill in what you know</p>

              <div class="grid grid-cols-2 sm:grid-cols-3 gap-4">
                <div>
                  <label for="fTargetPrice" class="block text-[11px] font-black uppercase tracking-[.12em] mb-1 text-black/70">
                    Target Price
                  </label>
                  <div class="relative">
                    <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm">$</span>
                    <input id="fTargetPrice" type="number" step="0.01" placeholder="0.00" class="w-full border-[4px] border-black pl-7 pr-3 py-2 text-sm outline-none focus:border-kkpink transition-colors" />
                  </div>
                </div>

                <div>
                  <label for="fUnitCost" class="block text-[11px] font-black uppercase tracking-[.12em] mb-1 text-black/70">
                    Unit Cost
                  </label>
                  <div class="relative">
                    <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm">$</span>
                    <input id="fUnitCost" type="number" step="0.01" placeholder="0.00" class="w-full border-[4px] border-black pl-7 pr-3 py-2 text-sm outline-none focus:border-kkpink transition-colors" />
                  </div>
                </div>

                <div>
                  <label for="fWeightG" class="block text-[11px] font-black uppercase tracking-[.12em] mb-1 text-black/70">
                    Weight (g)
                  </label>
                  <input id="fWeightG" type="number" step="1" placeholder="0" class="w-full border-[4px] border-black px-3 py-2 text-sm outline-none focus:border-kkpink transition-colors" />
                </div>

                <div>
                  <label for="fSupplierShip" class="block text-[11px] font-black uppercase tracking-[.12em] mb-1 text-black/70">
                    Supplier Ship/unit
                  </label>
                  <div class="relative">
                    <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm">$</span>
                    <input id="fSupplierShip" type="number" step="0.01" placeholder="Auto" class="w-full border-[4px] border-gray-300 bg-gray-50 pl-7 pr-3 py-2 text-sm outline-none focus:border-kkpink transition-colors" />
                  </div>
                </div>

                <div>
                  <label for="fStcc" class="block text-[11px] font-black uppercase tracking-[.12em] mb-1 text-black/70">
                    Ship to Customer
                  </label>
                  <div class="relative">
                    <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm">$</span>
                    <input id="fStcc" type="number" step="0.01" placeholder="Auto" class="w-full border-[4px] border-gray-300 bg-gray-50 pl-7 pr-3 py-2 text-sm outline-none focus:border-kkpink transition-colors" />
                  </div>
                </div>

                <div>
                  <label for="fBulkQty" class="block text-[11px] font-black uppercase tracking-[.12em] mb-1 text-black/70">
                    Bulk Qty
                  </label>
                  <input id="fBulkQty" type="number" step="1" placeholder="30" class="w-full border-[4px] border-black px-3 py-2 text-sm outline-none focus:border-kkpink transition-colors" />
                </div>
              </div>

              <p class="text-xs text-gray-400 mt-3">üí° Shipping costs auto-fill when you enter weight. You can still override manually.</p>
            </section>

            <!-- Profit Projections Panel (Dynamic) -->
            <div id="profitProjectionsPanel" class="hidden">
              <!-- Content populated by JS -->
            </div>

            <div class="border-t-4 border-gray-100"></div>

            <!-- Notes Section -->
            <section>
              <div class="text-[11px] font-black uppercase tracking-[.25em] flex items-center gap-2 mb-4">
                <span class="w-5 h-5 bg-black text-white text-[10px] flex items-center justify-center">3</span>
                Notes
              </div>

              <textarea
                id="fNotes"
                rows="4"
                placeholder="Supplier contact, sample notes, ideas..."
                class="w-full border-[4px] border-black px-3 py-2 text-sm resize-y outline-none focus:border-kkpink transition-colors"
              ></textarea>
            </section>
          </div>

          <!-- Foot -->
          <div class="sticky bottom-0 flex flex-col-reverse sm:flex-row items-center justify-between gap-3 p-3 sm:p-5 border-t-4 border-black bg-gray-50 shrink-0">
            <div class="flex gap-2 w-full sm:w-auto">
              <button
                id="btnArchive"
                type="button"
                class="flex-1 sm:flex-none border-4 border-gray-300 bg-white text-gray-700 px-4 py-2 font-black uppercase tracking-[.12em] text-xs
                       hover:bg-gray-100 transition-all"
              >
                üìÅ Archive
              </button>
              <button
                id="btnHardDelete"
                type="button"
                class="flex-1 sm:flex-none border-4 border-red-300 bg-white text-red-600 px-4 py-2 font-black uppercase tracking-[.12em] text-xs
                       hover:bg-red-500 hover:border-red-500 hover:text-white transition-all"
              >
                üóëÔ∏è Delete
              </button>
            </div>
            <button
              id="btnSave"
              type="button"
              class="w-full sm:w-auto border-4 border-black bg-black text-white px-6 py-2 font-black uppercase tracking-[.12em] text-xs
                     hover:bg-kkpink hover:border-kkpink hover:text-black transition-all"
            >
              Save Changes
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer mount -->
  <div id="kkFooterMount"></div>

  <!-- Click backdrop to close -->
  <script>
    (function () {
      const modal = document.getElementById("modal");
      const backdrop = modal?.querySelector("[data-kk-close]");
      const closeBtn = document.getElementById("btnClose");
      if (!modal || !backdrop || !closeBtn) return;
      backdrop.addEventListener("click", () => closeBtn.click());
    })();
  </script>

  <script type="module" src="/js/admin/pStorage/index.js"></script>
</body>
</html>
