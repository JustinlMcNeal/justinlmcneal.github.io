<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin · Orders</title>

  <!-- Tailwind (CDN ok for now) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Keep your global theme if you want (safe) -->
  <link rel="stylesheet" href="/css/theme/base.css" />
  <link rel="stylesheet" href="/css/theme/components.css" />
</head>

<body class="kk-page kk-admin bg-white text-black">
  <!-- Admin Nav mount -->
  <div id="kkAdminNavMount"></div>

  <main class="max-w-6xl mx-auto px-4 py-6">
    <!-- HEADER / KPIs -->
    <section class="bg-white border-[4px] border-black p-5">
      <div class="text-[11px] font-black uppercase tracking-[.25em] opacity-70">Admin</div>
      <h1 class="text-2xl sm:text-3xl font-black tracking-tight mt-2">Orders</h1>
      <p class="text-sm text-black/70 mt-2">
        Grouped orders view for totals, status, shipping, profit, and exports.
      </p>

      <div class="mt-5 border-t-[4px] border-black pt-5">
        <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
          <div class="border-[4px] border-black p-3">
            <div class="text-[10px] font-black uppercase tracking-[.22em] opacity-70">Orders</div>
            <div id="kpiOrders" class="text-xl font-black mt-1">—</div>
          </div>

          <div class="border-[4px] border-black p-3">
            <div class="text-[10px] font-black uppercase tracking-[.22em] opacity-70">Revenue</div>
            <div id="kpiRevenue" class="text-xl font-black mt-1">—</div>
          </div>

          <div class="border-[4px] border-black p-3">
            <div class="text-[10px] font-black uppercase tracking-[.22em] opacity-70">Profit</div>
            <div id="kpiProfit" class="text-xl font-black mt-1">—</div>
          </div>

          <div class="border-[4px] border-black p-3">
            <div class="text-[10px] font-black uppercase tracking-[.22em] opacity-70">Unfulfilled</div>
            <div id="kpiUnfulfilled" class="text-xl font-black mt-1">—</div>
          </div>
        </div>
      </div>
    </section>

    <!-- CONTROLS -->
    <section class="bg-white border-[4px] border-black p-5 mt-4">
      <div class="text-[11px] font-black uppercase tracking-[.25em]">Filter</div>

      <div class="grid gap-3 mt-4 md:grid-cols-2">
        <!-- Search -->
        <div>
          <label class="block text-[11px] font-black uppercase tracking-[.18em] mb-2" for="searchInput">
            Search
          </label>
          <input
            id="searchInput"
            type="search"
            placeholder="Order / email / name / coupon / status / tracking…"
            autocomplete="off"
            class="w-full border-[4px] border-black px-3 py-2 text-[13px] uppercase outline-none"
          />
          <div class="text-xs text-black/60 mt-2">
            Search runs across the full dataset (server-side).
          </div>
        </div>

        <!-- Status -->
        <div>
          <label class="block text-[11px] font-black uppercase tracking-[.18em] mb-2" for="statusFilter">
            Status
          </label>
          <select
            id="statusFilter"
            class="w-full border-[4px] border-black px-3 py-2 text-[13px] uppercase bg-white outline-none"
          >
            <option value="">All statuses</option>
            <option value="pending">Pending</option>
            <option value="label_purchased">Label Purchased</option>
            <option value="shipped">Shipped</option>
            <option value="delivered">Delivered</option>
            <option value="voided">Voided</option>
            <option value="returned">Returned</option>
          </select>
          <div class="text-xs text-black/60 mt-2">
            Status is stored in fulfillment_shipments.
          </div>
        </div>
      </div>

      <div class="grid gap-3 mt-4 md:grid-cols-3 items-end">
        <div>
          <label class="block text-[11px] font-black uppercase tracking-[.18em] mb-2" for="dateFrom">
            Date From
          </label>
          <input id="dateFrom" type="date" class="w-full border-[4px] border-black px-3 py-2 text-[13px] outline-none" />
        </div>

        <div>
          <label class="block text-[11px] font-black uppercase tracking-[.18em] mb-2" for="dateTo">
            Date To
          </label>
          <input id="dateTo" type="date" class="w-full border-[4px] border-black px-3 py-2 text-[13px] outline-none" />
        </div>

        <div class="flex flex-col gap-2">
          <div class="text-[11px] font-black uppercase tracking-[.18em]">Action</div>

          <button
            id="btnRefresh"
            type="button"
            class="border-[4px] border-black bg-white px-4 py-2 font-black uppercase tracking-[.14em] text-[11px]
                   hover:bg-black hover:text-white transition"
          >
            Refresh
          </button>

          <div class="flex items-center justify-between gap-3">
            <div id="countLabel" class="text-xs text-black/60">0 rows</div>
            <div id="status" class="text-xs text-black/60"></div>
          </div>
        </div>
      </div>

      <div class="border-t-[4px] border-black mt-5 pt-5">
        <div class="flex flex-wrap gap-2 items-center">
          <button
            id="btnExportShipReady"
            type="button"
            class="border-[4px] border-black bg-black text-white px-4 py-2 font-black uppercase tracking-[.14em] text-[11px]
                   hover:bg-white hover:text-black transition"
          >
            Export Ship-Ready CSV
          </button>

          <button
            id="btnImportPirateShip"
            type="button"
            disabled
            class="border-[4px] border-black bg-white px-4 py-2 font-black uppercase tracking-[.14em] text-[11px]
                   opacity-50 cursor-not-allowed"
          >
            Import Pirate Ship Export
          </button>

          <div class="text-xs text-black/60">
            Ship-ready export will be used for Pirate Ship batch label printing.
          </div>
        </div>
      </div>
    </section>

<!-- TABLE -->
<section class="mt-4 border-[4px] border-black bg-white">
  <div class="overflow-x-auto">
    <table id="ordersTable" class="w-full min-w-[1100px] border-collapse">
      <thead class="bg-white border-b-[4px] border-black">
        <tr class="text-left">
          <th class="px-4 py-3 text-[11px] font-black uppercase tracking-[.22em] whitespace-nowrap">Date</th>
          <th class="px-4 py-3 text-[11px] font-black uppercase tracking-[.22em] whitespace-nowrap">Order</th>
          <th class="px-4 py-3 text-[11px] font-black uppercase tracking-[.22em] whitespace-nowrap">Customer</th>
          <th class="px-4 py-3 text-[11px] font-black uppercase tracking-[.22em] whitespace-nowrap">Email</th>
          <th class="px-4 py-3 text-[11px] font-black uppercase tracking-[.22em] whitespace-nowrap">Items</th>
          <th class="px-4 py-3 text-[11px] font-black uppercase tracking-[.22em] whitespace-nowrap">Weight</th>
          <th class="px-4 py-3 text-[11px] font-black uppercase tracking-[.22em] whitespace-nowrap">Paid</th>
          <th class="px-4 py-3 text-[11px] font-black uppercase tracking-[.22em] whitespace-nowrap">Cost</th>
          <th class="px-4 py-3 text-[11px] font-black uppercase tracking-[.22em] whitespace-nowrap">Profit</th>
          <th class="px-4 py-3 text-[11px] font-black uppercase tracking-[.22em] whitespace-nowrap">Status</th>
          <th class="px-4 py-3 text-[11px] font-black uppercase tracking-[.22em] whitespace-nowrap">Tracking</th>
          <th class="px-4 py-3 text-[11px] font-black uppercase tracking-[.22em] whitespace-nowrap text-right">Action</th>
        </tr>
      </thead>

      <!-- subtle row dividers instead of thick boxes -->
      <tbody id="ordersRows" class="divide-y divide-black/15">
        <!-- JS renders rows -->
      </tbody>
    </table>
  </div>

  <!-- Footer -->
  <div class="border-t-[4px] border-black p-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
    <button
      id="btnLoadMore"
      type="button"
      class="inline-flex items-center justify-center gap-2 border-[4px] border-black bg-white px-4 py-2
             font-black uppercase tracking-[.14em] text-[11px]
             hover:bg-black hover:text-white transition"
    >
      <span>Load more</span>
      <span aria-hidden="true">↓</span>
    </button>

    <div id="loadMoreStatus" class="text-xs text-black/60"></div>
  </div>
</section>

  </main>

  <!-- EDIT MODAL -->
  <div id="modal" class="hidden fixed inset-0 z-[9999]" aria-hidden="true">
    <!-- Backdrop -->
    <div class="absolute inset-0 bg-black/40" data-modal-close></div>

    <!-- Stage -->
    <div class="relative w-full h-full flex items-end sm:items-center justify-center p-3 sm:p-6">
      <div class="w-full max-w-3xl bg-white border-[4px] border-black">
        <!-- Head -->
        <div class="p-4 sm:p-5 flex items-start justify-between gap-4">
          <div>
            <div id="modalKicker" class="text-[11px] font-black uppercase tracking-[.25em] opacity-70">Order</div>
            <h2 id="modalTitle" class="text-xl sm:text-2xl font-black mt-1">Edit Shipment</h2>
            <div id="modalSub" class="text-sm text-black/70 mt-1">Update label + tracking info.</div>
          </div>

          <button
            id="btnClose"
            type="button"
            aria-label="Close"
            class="border-[4px] border-black bg-white w-10 h-10 flex items-center justify-center font-black
                   hover:bg-black hover:text-white transition"
          >
            ✕
          </button>
        </div>

        <div class="border-t-[4px] border-black"></div>

        <!-- Body -->
        <div class="p-4 sm:p-5">
          <div id="modalMsg" class="text-sm text-black/70 mb-3"></div>

          <!-- Readonly IDs -->
          <div class="grid gap-3 sm:grid-cols-2">
            <div>
              <label class="block text-[11px] font-black uppercase tracking-[.18em] mb-2" for="fSessionId">
                Stripe Session ID
              </label>
              <input
                id="fSessionId"
                type="text"
                readonly
                class="w-full border-[4px] border-black px-3 py-2 text-[13px] outline-none bg-white/60"
              />
            </div>

            <div>
              <label class="block text-[11px] font-black uppercase tracking-[.18em] mb-2" for="fKkOrderId">
                KK Order ID
              </label>
              <input
                id="fKkOrderId"
                type="text"
                readonly
                class="w-full border-[4px] border-black px-3 py-2 text-[13px] outline-none bg-white/60"
              />
            </div>
          </div>

          <div class="border-t-[4px] border-black my-5"></div>

          <!-- Editable fields -->
          <div class="grid gap-3 sm:grid-cols-2">
            <div>
              <label class="block text-[11px] font-black uppercase tracking-[.18em] mb-2" for="fLabelStatus">
                Label Status
              </label>
              <select
                id="fLabelStatus"
                class="w-full border-[4px] border-black px-3 py-2 text-[13px] uppercase bg-white outline-none"
              >
                <option value="pending">Pending</option>
                <option value="label_purchased">Label Purchased</option>
                <option value="shipped">Shipped</option>
                <option value="delivered">Delivered</option>
                <option value="voided">Voided</option>
                <option value="returned">Returned</option>
              </select>
            </div>

            <div>
              <label class="block text-[11px] font-black uppercase tracking-[.18em] mb-2" for="fTrackingNumber">
                Tracking Number
              </label>
              <input
                id="fTrackingNumber"
                type="text"
                placeholder="9400..."
                class="w-full border-[4px] border-black px-3 py-2 text-[13px] outline-none"
              />
            </div>

            <div>
              <label class="block text-[11px] font-black uppercase tracking-[.18em] mb-2" for="fCarrier">
                Carrier
              </label>
              <input
                id="fCarrier"
                type="text"
                placeholder="USPS / UPS / FedEx"
                class="w-full border-[4px] border-black px-3 py-2 text-[13px] outline-none"
              />
            </div>

            <div>
              <label class="block text-[11px] font-black uppercase tracking-[.18em] mb-2" for="fService">
                Service
              </label>
              <input
                id="fService"
                type="text"
                placeholder="Ground Advantage, Priority..."
                class="w-full border-[4px] border-black px-3 py-2 text-[13px] outline-none"
              />
            </div>

            <div>
              <label class="block text-[11px] font-black uppercase tracking-[.18em] mb-2" for="fBatchId">
                Batch ID
              </label>
              <input
                id="fBatchId"
                type="text"
                placeholder="2025-12-25-A"
                class="w-full border-[4px] border-black px-3 py-2 text-[13px] outline-none"
              />
            </div>

            <div>
              <label class="block text-[11px] font-black uppercase tracking-[.18em] mb-2" for="fPrintedAt">
                Printed At
              </label>
              <input
                id="fPrintedAt"
                type="datetime-local"
                class="w-full border-[4px] border-black px-3 py-2 text-[13px] outline-none"
              />
            </div>

            <div>
              <label class="block text-[11px] font-black uppercase tracking-[.18em] mb-2" for="fLabelCost">
                Label Cost ($)
              </label>
              <input
                id="fLabelCost"
                type="number"
                step="0.01"
                placeholder="4.23"
                class="w-full border-[4px] border-black px-3 py-2 text-[13px] outline-none"
              />
            </div>

            <div>
              <label class="block text-[11px] font-black uppercase tracking-[.18em] mb-2" for="fPackageWeightGFinal">
                Final Package Weight (g)
              </label>
              <input
                id="fPackageWeightGFinal"
                type="number"
                step="1"
                placeholder="320"
                class="w-full border-[4px] border-black px-3 py-2 text-[13px] outline-none"
              />
            </div>

            <div class="sm:col-span-2">
              <label class="block text-[11px] font-black uppercase tracking-[.18em] mb-2" for="fPirateShipShipmentId">
                Pirate Ship Shipment ID
              </label>
              <input
                id="fPirateShipShipmentId"
                type="text"
                placeholder="pship_..."
                class="w-full border-[4px] border-black px-3 py-2 text-[13px] outline-none"
              />
            </div>

            <div class="sm:col-span-2">
              <label class="block text-[11px] font-black uppercase tracking-[.18em] mb-2" for="fNotes">
                Notes
              </label>
              <textarea
                id="fNotes"
                rows="4"
                placeholder="Any fulfillment notes..."
                class="w-full border-[4px] border-black px-3 py-2 text-[13px] outline-none"
              ></textarea>
            </div>
          </div>
        </div>

        <div class="border-t-[4px] border-black"></div>

        <!-- Foot -->
        <div class="p-4 sm:p-5 flex flex-col sm:flex-row gap-2 sm:justify-end">
          <button
            id="btnCancel"
            type="button"
            class="border-[4px] border-black bg-white px-4 py-2 font-black uppercase tracking-[.14em] text-[11px]
                   hover:bg-black hover:text-white transition"
          >
            Cancel
          </button>

          <button
            id="btnSave"
            type="button"
            class="border-[4px] border-black bg-black text-white px-4 py-2 font-black uppercase tracking-[.14em] text-[11px]
                   hover:bg-white hover:text-black transition"
          >
            Save
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer mount -->
  <div id="kkFooterMount"></div>

  <!-- Orders logic -->
  <script type="module" src="/js/admin/lineItemsOrders/index.js"></script>
</body>
</html>
